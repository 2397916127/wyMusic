<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>ç½‘æ˜“äº‘éŸ³ä¹æ’­æ”¾å™¨</title>
		<script src="jquery3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="date.js" type="text/javascript" charset="utf-8"></script>
		<script src="wyy.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="wyy.css"/>
	</head>
	<style type="text/css">
		.choosen{
			background-color: rgba(96,96,96,0.1);
			z-index: 1;
		}
	</style>
	<body>
		<div id="container">
			<nav>
				<div class="tb"></div>
				<h3 class="fl navH3">ç½‘æ˜“äº‘éŸ³ä¹</h3>
				<input class="fl navInput" type="text" placeholder="æœç´¢" id="search"/>
				<ul class="navUl">
					<li style="font-size: 2em;">Ã—</li>
					<li class="cover">çš®è‚¤</li>
					<li class="regis">ç™»å½•</li>
				</ul>
			</nav>
			<div id="main">
				<div class="main">
					<aside class="leftAside fl">
						<div id="singer">
							<img src="" width="200px">
						</div>
						<ul class="leftUl">
							<li><em style="color: #C10D0C;">â¤</em> å–œæ¬¢</li>
							<li><em>â­</em> æ”¶è—</li>
							<li><em style="color: #666;font-weight: bold;">â†“</em> ä¸‹è½½</li>
							<li><em style="color: #666;font-weight: bold;">â†‘</em> åˆ†äº«</li>
						</ul>
					</aside>
					<aside class="rightAside fr">
						<h3></h3>
						<ul class="rightUl">
							<li>ä¸“è¾‘ï¼š<em></em></li>
							<li>æ­Œæ‰‹ï¼š<em></em></li>
							<li>ä¸“è¾‘ï¼š<em></em></li>
						</ul>
						<div id="words">
						</div>
					</aside>
				</div>
				<div id="community">
					<div class="drive"></div>
					<div id="comBody">
						<p><span>å¬å‹è¯„è®º </span>(å·²æœ‰<em>2</em>æ¡è¯„è®º)</p>
						<input type="text" onfocus="this.blur()" id="comText" placeholder="å‘è¡¨è¯„è®º"/>
						<p class="goodCom">ç²¾å½©è¯„è®º</p>
						<div class="drive2"></div>
						<div class="coms">
							<div class="comImg fl"></div>
							<div class="comBox fl">
								<p class="comDetail">
									<em></em>
									<span></span>
								</p>
								<span class="comDate comColor"></span>
								<span class="fr comColor">ğŸ‘ç‚¹èµ|åˆ†äº«|å›å¤</span>
							</div>
						</div>
						<div class="coms">
							<div class="comImg fl"></div>
							<div class="comBox fl">
								<p class="comDetail">
									<em></em>
									<span></span>
								</p>
								<span class="comDate comColor"></span>
								<span class="fr comColor">ğŸ‘ç‚¹èµ|åˆ†äº«|å›å¤</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div id="songList">
				<div class="curList">å½“å‰æ­Œå•</div>
				<div class="hisList choosen">å†å²è®°å½•</div>
				<div id="listBox">
					<ul class="listCtr">
						<li class="fl songNum">å…±<em></em>é¦–æ­Œæ›²</li>
						<li class="fr clearAll">æ¸…ç©º</li>
					</ul>
					<ul class="songs"></ul>
					<ul class="listCtr2">
						<li class="fl songNum2">å…±<em></em>é¦–æ­Œæ›²</li>
						<li class="fr clearAll2">æ¸…ç©º</li>
					</ul>
					<ul class="hisongs"></ul>
				</div>
			</div>
			<footer>
				<ul id="footerUl">
					<!-- ä¸Šä¸€é¦– -->
					<li class="last boot"><em><</em></li>
					<!-- æ’­æ”¾æš‚åœ -->
					<li class="pause boot"><em>â–²</em></li>
					<!-- ä¸‹ä¸€é¦– -->
					<li class="next boot"><em>></em></li>
					<!-- è¿›åº¦æ¡ -->
					<div id="curbar" class="fl" bar-content-after="" bar-content-before="0:00">
						<input type="range" id="bar" value="0"  min="0" max="300"/>
					</div>
					<!-- éŸ³é‡-->
					<div id="volum" class="fl">
						<span class="fl volumOff">ğŸ”ˆ</span>
						<input type="range" id="volumbar" value="1" min="0" max="1" step="0.1"/>
					</div>
					<!-- å¾ªç¯æ–¹å¼ -->
					<li class="loop sel">åˆ—è¡¨å¾ªç¯</li>
					<!-- æ­Œå•åˆ—è¡¨ -->
					<li class="playlist sel">æ­Œå•</li>
					<!-- æ­Œè¯ -->
					<li class="words sel">æ­Œè¯</li>
				</ul>
				<audio>
					å½“å‰æµè§ˆå™¨ä¸æ”¯æŒaudio
				</audio>
			</footer>
			<div id="login">
				<em>Ã—</em>
				<input type="text" class="btn1" id="username" placeholder="è´¦æˆ·" />
				<input type="text" class="btn2" id="password" placeholder="å¯†ç " />
				<input type="checkbox" id="rempwd" class="remem"/><span>è®°ä½å¯†ç </span>
				<button type="button" id="userLogin">ç™»å½•</button>
			</div>
			<div id="comBox">
				<span class="close">Ã—</span>
				<nav></nav>
				<textarea rows="10" cols="50"></textarea>
				<button type="button">è¯„è®º</button>
			</div>
		</div>
		<div id="colorPicker">
			<canvas id="colorBox" width="500px" height="300px"></canvas>
		</div>
		<div id="zhuomian">ç½‘æ˜“äº‘éŸ³ä¹</div>
	</body>
	<script type="text/javascript">		
		var id = 1;//å½“å‰æ’­æ”¾çš„éŸ³ä¹
		var userId;
		var judgePlay;
		var angle=0;//æ—‹è½¬è§’åº¦
		var audio = document.getElementsByTagName("audio")[0];
		var song,album,singer,source,url,cover,lyric,love,msg,lrcs;
		var model = ['åˆ—è¡¨å¾ªç¯','å•æ›²å¾ªç¯','éšæœºæ’­æ”¾','é¡ºåºæ’­æ”¾'];
		var mol = 0;
		var start;
		var lrcss;
		var curtime;
		var pic;
		var loginCout = 0;
		var open = false;
		var skinColor = "#C20C0C";
		var canvas = document.getElementById("colorBox");
		var ctx = canvas.getContext('2d');
		init();
		initSongs();
		getImg();
		drawcolorPicker();
		listChange();
		//æ˜¾ç¤ºå½“å‰æ­Œå•
		$('.curList').click(function(){
			$('.hisongs').css("display","none");
			$('.listCtr2').css("display","none");
			$('.hisList').addClass("choosen");
			$('.curList').removeClass("choosen");
			$('.songs').css("display","block");
			$('.listCtr').css("display","block");
		})
		//æ˜¾ç¤ºå†å²æ­Œå•
		$('.hisList').click(function(){
			$('.songs').css("display","none");
			$('.listCtr').css("display","none");
			$('.hisList').removeClass("choosen");
			$('.curList').addClass("choosen");
			$('.hisongs').css("display","block");
			$('.listCtr2').css("display","block");
		})
		//æ¸…ç©ºæ­Œå•
		$('.clearAll').click(function(){
			if($('.songs').css("display") == "block"){
				$('.songs').html("");
				$('.songNum').children().eq(0).text("0");
				zanting();
			}else{
				$('.hisongs').html("");
				$('.songNum').children().eq(0).text("0");
			}
		})
		//æ‹–æ‹½åŠŸèƒ½
		$("#container>nav").mousedown(function(e) {
			$(this).css("cursor","move");
			// å½“é¼ æ ‡æŒ‰ä¸‹ï¼Œè·å–é¼ æ ‡ä½ç½®
			var mouseOldX = e.pageX;
			var mouseOldY = e.pageY;
			// ä¸ºé¼ æ ‡æ·»åŠ ç§»åŠ¨äº‹ä»¶
			$(this).on("mousemove", function(e) {
				// å½“é¼ æ ‡è¿åŠ¨æ—¶è·å–é¼ æ ‡çš„ä½ç½®
				var mouseNewX = e.pageX;
				var mouseNewY = e.pageY;
				// è®¡ç®—é¼ æ ‡ç§»åŠ¨çš„è·ç¦»
				var moveX = mouseNewX - mouseOldX; //xç§»åŠ¨çš„è·ç¦»
				var moveY = mouseNewY - mouseOldY; //yç§»åŠ¨çš„è·ç¦»
				//å°†æ–°çš„é¼ æ ‡ä½ç½®ä¿å­˜
				mouseOldX = mouseNewX;
				mouseOldY = mouseNewY;
				//å°†æ ‡ç­¾ä½ç½®æŒ‰ç…§é¼ æ ‡ç§»åŠ¨çš„è·ç¦»è¿›è¡Œç§»åŠ¨
				var divOldXY = $(this).offset();
				$('#container').offset({
					left: divOldXY.left + moveX,
					top: divOldXY.top + moveY
				})
				//ä¸ºé¼ æ ‡æ·»åŠ æŠ¬èµ·äº‹ä»¶
				$(this).on("mouseup mouseout", function() {
					// æ¸…é™¤å½“å‰æ ‡ç­¾çš„é¼ æ ‡ç§»åŠ¨äº‹ä»¶
					$(this).css("cursor","default");
					$(this).off("mousemove");
				});
		
			});
		})
		//å±•å¼€è°ƒè‰²æ¿
		$('.cover').click(function(){
			var dis = $('#colorPicker');
			if(dis.css("display") == "none") dis.css("display","block");
		})
		//é¼ æ ‡åœ¨è°ƒè‰²æ¿ä¸Šç‚¹å‡»
		$('#colorBox').mousedown(function(e){
			var x = e.clientX;
			var y = e.clientY;
			var xx = $('#colorPicker').offset().left;
			var yy = $('#colorPicker').offset().top;
			if(x<xx) x=0;
			else x-=xx;
			if(y<yy) y=0;
			else y-=yy;
			var imgDate = ctx.getImageData(x,y,2,2);
			skinColor = "rgb("+imgDate.data[0]+","+imgDate.data[1]+","+imgDate.data[2]+")";
			$('#colorPicker').css("display","none");
			changeColor();//æ”¹å˜ä¸»ä½“é¢œè‰²
		})
		//ç™»å½•
		$('#userLogin').click(function(){
			loginCout++;
			var isLogin = "æœªç™»å½•";
			var username = $('#username').val();
			var pwd = $('#password').val();
			var checked = $('#rempwd').prop('checked');
			for(var i=0;i<users.length;i++){
				var user = users[i];
				if(username == user.name){
					if(pwd == user.pwd){
						loginCout=0;
						isLogin = "ç™»å½•æˆåŠŸ";
						alert(isLogin);
						pic = user.pic;
						$('.regis').text("");
						$('.regis').append('<img src="'+pic+'">'+username);
						$('#login').css("display","none");
						if(checked){
							window.localStorage.setItem("username",username);
							window.localStorage.setItem("pwd",pwd);
						}else{
							window.localStorage.removeItem('username');
							window.localStorage.removeItem('pwd');
						}
						break;
					}else{
						isLogin = "å¯†ç é”™è¯¯";
						alert(isLogin);
						break;
					}
				}
				if(pwd == user.pwd){
					if(username != user.name && i == users.length-1) {
						isLogin = "è´¦å·ä¸å­˜åœ¨";
						alert(isLogin);
						break;
					}
				}
			}
			if(isLogin == "æœªç™»å½•"){
				isLogin = "è´¦æˆ·å’Œå¯†ç ä¸æ­£ç¡®";
				alert(isLogin);
			}
			if(loginCout==3){
				alert("æ‚¨å·²ç»è¿ç»­ä¸‰æ¬¡ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åå†è¯•");
				$('#login').css("display","none");
			}
		})
		//è·å–éŸ³é¢‘æ€»æ—¶é•¿
		audio.oncanplaythrough = function(){
			var time = audio.duration;
			$('#bar').attr("max",time);
			$('#curbar').attr("bar-content-after",formatSeconds(time));
		}
		//æ”¹å˜å½“å‰æ’­æ”¾çš„æ—¶é—´
		audio.ontimeupdate = function(){
			var time = this.currentTime;
			$('#bar').val(time);
			$('#curbar').attr("bar-content-before",formatSeconds(time));
			
		}
		$('#bar').mousedown(function(){
			if(audio.pause()){
				judgePlay = false;
			}else{
				judgePlay = true;
			}
		})
		$('#bar').on("input",function(){
			var curVal = $(this).val();//è·å–å½“å‰çš„ä½ç½®
			$('#curbar').attr("bar-content-before",formatSeconds(curVal));
			//æ”¹å˜
		})
		$('#bar').change(function(){
			var curVal = $(this).val();
			audio.currentTime = curVal;
			if(judgePlay){
				if(start != undefined)	noSpin(); 
				bofang();
			}
		})
		//æ˜¾ç¤ºæ­Œå•
		$('.playlist').click(function(){
			var list = $('#songList');
			if(list.css("display") == "none") list.css("display","block");
			else list.css("display","none");
		})
		//ç‚¹å‡»æ­Œå•åˆ‡æ­Œ
		$('.songs li,.hisongs li').click(function(){
			id = $(this).index()+1;
			$('.songs li').css("color","#ddd");
			$(this).css("color",skinColor);
			init();
			if(start != undefined)	noSpin(); 
			bofang();
		})
		//æš‚åœå’Œæ’­æ”¾
		$('.pause').click(function(){
			if($(this).text() == "||"){zanting();}
			else {bofang();}
		})
		// é™éŸ³åŠŸèƒ½
		$('.volumOff').click(function(){
			if(audio.volume != "0"){
				audio.volume = 0;
				$('#volumbar').val(0);
				$(this).css("opacity","0.4");
			}else{
				audio.volume = 0.4;
				$(this).css("opacity","1");
				$('#volumbar').val(0.4);
			}
		})
		//æ‹–åŠ¨è¿›åº¦æ¡æ”¹å˜éŸ³é‡
		$('#volumbar').on("input",function(){
			audio.volume = $(this).val();
			if(audio.volume == 0){
				$('.volumOff').css("opacity","0.4");
			}else{
				$('.volumOff').css("opacity","1");
			}
		})
		$('.next').click(function(){nextSong();})//ä¸‹ä¸€é¦–
		$('.last').click(function(){lastSong();})//ä¸Šä¸€é¦–
		//æ­Œè¯æ»šåŠ¨
		$('audio').on('timeupdate',function(){
			var ps = $('#words').children();
			var sj = Math.ceil(audio.currentTime)-1;
			for(var i=0;i<ps.length;i++){
				if(sj == ps.eq(i).attr("time")){
					ps.css({"color":"#000","font-size":"1em"});
					ps.eq(i).css({"color":skinColor,"font-size":"1.2em"});
					document.getElementById("words").scrollTop = i*30-100;	
					$('#zhuomian').text(ps.eq(i).text());
					break;
				}
			}
		})
		//æ‰“å¼€æ­Œè¯
		$('.words').click(function(){
			if(open){
				open = false;
				$(this).css("opacity","0.5");
				$('#zhuomian').css("display","none");
			}else{
				open = true;
				$(this).css("opacity","1");
				$("#zhuomian").css("display","block");
			}
		})
		//æ‰“å¼€ç™»å½•æ¡†
		$('.regis').click(function(){
			if($(this).text() == "ç™»å½•") $('#login').css("display","block");
		})
		//å…³é—­ç™»å½•æ¡†
		$('#login>em').click(function(){
			$('#login').css("display","none");
		})
		//æ‰“å¼€è¯„è®ºæ¡†
		$('#comText').click(function(){
			if($('.regis').text() != "ç™»å½•"){
				$('#comBox').css("display","block");
				$('#comText').attr("select","selected");
				$('#comBox>nav').text(song);
			} 
			else{
				document.getElementById("main").scrollTop = 0;
				$('#login').css("display","block");
			}
		})
		//å…³é—­è¯„è®ºæ¡†
		$('.close').click(function(){
			$('#comBox').css("display","none");
		})
		//æäº¤è¯„è®º
		$('#comBox>button').click(function(){
			var inf = $('#comBox>textarea').val();
			$('#comBox').css("display","none");
			addCom(inf);
		})
		//åˆ‡æ¢å¾ªç¯æ–¹å¼
		$('.loop').click(function(){
			$(this).text(model[mol]);
			if(mol==3) mol=0;
			else mol++;
		})
		audio.onended = function(){
			switch(mol){
				//åˆ—è¡¨å¾ªç¯
				case 0:
					id++;
					if(id==5) id=1;
					init();
					bofang();
					addList();
					break;
				// å•æ›²æ’­æ”¾
				case 1:
					bofang();
					break;
				//éšæœºæ’­æ”¾
				case 2:
					id = parseInt(Math.random()*4);
					init();
					bofang();
					break;
				//é¡ºåºæ’­æ”¾
				case 3:
					id++;
					if(id<=4){
						init();
						bofang();
					}else{
						id--;
						init();
						bofang();
					}
					break;
			}
		}
	</script>
</html>
